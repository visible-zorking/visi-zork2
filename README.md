# The Visible Zorker 2: an interactive fiction visualizer

- Designed by Andrew Plotkin <erkyrath@eblong.com>
- Web site: https://eblong.com/infocom/visi-zork2/

This is a web app that plays Zork 2, and simultaneously displays the code that runs Zork 2 under the hood. It allows you to explore the implementation of Zork in the same way that you explore the game world. Call it an exercise in exploratory coding.

To try the Visible Zorker 2, [play it here][visizork]. You can also try [Zork 1][visizork1]. For more about the intent and origins of the project, see my [blog post on the subject][post].

[post]: https://blog.zarfhome.com/2025/01/the-visible-zorker
[visizork]: https://eblong.com/infocom/visi-zork2/
[visizork1]: https://eblong.com/infocom/visi-zork1/

## The contents of this repository

This repo contains quite a lot of material relating to Zork 2. Some of this is needed to run the game; some is used in the app UI; some was just useful to me in creating the app.

### The [`gamedat`](./gamedat) directory

This contains the Zork 2 game file itself, plus a bonanza of information about how it is organized internally.

- zork2-r48-s840904.z3: Zork 2, release 48, serial 840904. (This is the playable Z-code file.) It's the version on the [Masterpieces of Infocom][masterpieces] CD and other modern collections. For other versions, see my [Obsessively Complete Infocom Catalog][ocicat].
- [`game-dump.txt`](./gamedat/game-dump.txt): A disassembly listing of the game file, generated by `txd` from the [ztools][] package. This shows the game functions in the form of Z-machine "assembly", plus the text of the game. But it does not have function names; everything is shown as raw addresses.
- [`obj-dump.txt`](./gamedat/obj-dump.txt): A listing of the objects in the game file, generated by `infodump -o` (also from [ztools][]). This shows the object tree layout, the printed names of objects, and their properties as raw numeric data.
- [`dict-dump.txt`](./gamedat/dict-dump.txt): A listing of the game dictionary, generated by `infodump -d`. Again, this contains the flags associated with each dict word in raw numeric form.
- [`zork2.reform`](./gamedat/zork2.reform): A text file mapping game object numbers, global variables, and other numeric values to human-readable names. This is taken from the [analysis work][reform] done in 2007 by Allen Garvin, Ben Rudiak-Gould, and Ethan Dicks. (Original file [here][z2reform].)
- [`game-info`](./gamedat/game-info): A text file mapping game object numbers, global variables, and other numeric values to their ZIL source names. I created this in the course of building the Visible Zorker. It draws on *all* of the above data sources.
- [`commentary`](./gamedat/commentary): A text file containing my commentary and notes on the Zork 2 source.

[masterpieces]: https://archive.org/details/InfocomClassicTextAdventureMasterpieces1996JewelCaseArt
[ocicat]: https://eblong.com/infocom/
[ocicatz]: https://eblong.com/infocom/#zork2
[ztools]: https://ifarchive.org/indexes/if-archive/infocom/tools/ztools/
[reform]: https://ifarchive.org/indexes/if-archive/infocom/tools/reform/
[z2reform]: https://unbox.ifarchive.org/2h08txtsli/conf/Zork2_48_840904.reform

Note that the human-readable symbol names in `zork2.reform` do *not* match the actual ZIL source code. That work was done before the ZIL source was available, so Allen and the others just invented names that made sense. (They tried to be consistent with Inform 6 conventions, which was useful at the time but not for our purposes here.)

The `game-info` file is my own work, which *does* associate everything with its original ZIL name.

Also note that I'm using a slight modification of the [ztools][] package, which displays output in ways that are a bit easier to parse. (We have a lot of scripts which imbibe the `game-dump.txt`, `obj-dump.txt`, `dict-dump.txt` files.) See [my fork here][ztools-esc].

[ztools-esc]: https://github.com/erkyrath/ztools/tree/c-out


### The [`gamesrc`](./gamesrc) directory

This contains the original ZIL source code for Zork 2.

A version of this source was [publicly released][histzork2] in April 2019 by Jason Scott. If you look at that repository up front, you'll see zork2-r63-s860811. The version here, zork2-r48-s840904, can be found in its commit history [here][histzork2-r48].

(Other versions can be found in the [Catalog][ocicatz].)

[histzork2]: https://github.com/historicalsource/zork2
[histzork2-r48]: https://github.com/historicalsource/zork2/commit/d26f1573576909c6da9a02adc0c9d428c99c873f

### The [`js`](./js) directory

Javascript used in running the app. This is all generated, compiled, or minified from the contents of the [`visiterp/src`][terpsrc], [`gamesrc`](./gamesrc), and [`gamedat`](./gamedat) directories.

### The [`src/game`](./src/game) directory

JSON data files describing Zork 2. (JSONP, really.) These are generated by `pyana`, and then compiled into the app.

### The [`src/custom`](./src/custom) directory

Code specific to parsing and displaying Zork 2.

### The [`src/visi`](./src/visi) directory

This is a symlink to `visiterp/src/visi`; see below. (It's convenient for compilation if all the source files are at the same depth.)

### The [`visiterp`][visiterp] submodule

Most of the source code involved in running and displaying the game is collected in [`visiterp`][visiterp]. This is a separate repository so that it can be shared between many games.

If you find that the `visiterp` directory is empty, you need to fill it out:

```
git submodule init
git submodule update
```

Sorry. Submodules are a pain in the ass.

[visiterp]: https://github.com/erkyrath/visiterp
[terpsrc]: https://github.com/erkyrath/visiterp/tree/master/src
[terppyana]: https://github.com/erkyrath/visiterp/tree/master/pyana
[terpfont]: https://github.com/erkyrath/visiterp/tree/master/font
[terpcss]: https://github.com/erkyrath/visiterp/tree/master/css

The `visiterp` repository provides: 

### The [`visiterp/pyana`][terppyana] directory

Python scripts which parse the [`gamedat`](./gamedat) and [`gamesrc`](./gamesrc) files and convert them into JSON data in [`js`](./js) for the Visible Zorker to load.

Roughly, we need to parse all the ZIL source *and* the disassembled data, match up numeric addresses with source code names, and write it out in a format that the Javascript app can handle. We use a motley boatload of strategies to accomplish this. The [`game-info`](./gamedat/game-info) gives us a lot of the needed mappings. Others are based on source code order, memory address order, or whatever else works.

### The [`visiterp/src`][terpsrc] directory

Javascript and Typescript sources for the Visible Zorker app itself.

- `src/visi`: The front-end UI of the app. This is React code written in Typescript.
- `src/gnusto`: The Gnusto Z-machine engine. This is a part of the [Parchment][] IF web app. I modified Gnusto to track game activity and export it to the `visi` UI.
- `src/parchment`: Another component of Parchment, responsible for loading the game file and launching the app.
- `src/ifvms.js`: Another component of Parchment which acts as a glue layer between Gnusto and the browser display. Also a component which is responsible for the save-file format.
- `src/glkio`: The [GlkOte][] IF display library. Also a glue layer which allows Gnusto/IFVMS to use GlkOte.
- `src/lib`: Low-level JS libraries used by Gnusto and GlkOte. This includes [jQuery][].
- `src/game`: JSON data files describing the Zork game file. This includes the names and addresses of global variables, functions, objects, and everything else needed to make the game's operation visible. This folder also includes the ZIL source and the game commentary, translated into JSON form.

[GlkOte]: https://eblong.com/zarf/glk/glkote.html
[jQuery]: https://jquery.com/

Yeah, there's a lot of glue layers in there. It's the usual software-engineering story. Gnusto was originally written in 2003 as a browser extension. Then it was modified into a browser *application*, which was turned into a [web site][iplayif], which was expanded to support other formats besides Z-code. Each of these steps added more layers of abstraction.

[iplayif]: https://iplayif.com/

I unwound a lot of that work in creating the Visible Zorker. I wanted a *simple* interpreter engine, and I didn't need the web site or any of the newer formats. But there's still traces of some of the layers.

### The [`visiterp/css`][terpcss] directory

CSS files. Also some icon images in SVG, PNG, and animated-GIF format.

### The [`visiterp/font`][terpfont] directory

Open-source fonts used in the app.

- [Courier Prime](https://fonts.google.com/specimen/Courier+Prime)
- [Lato](https://fonts.google.com/specimen/Lato)
- [Libre Baskerville](https://fonts.google.com/specimen/Libre+Baskerville)











```
python3 visiterp/pyana/parse.py --game zork2-r48-s840904 -z gamesrc/zork2.zil --obj --dict --txd --gamedat
python3 visiterp/pyana/parse.py --game zork2-r48-s840904 -z gamesrc/zork2.zil --src
python3 visiterp/pyana/comgen.py gamedat/commentary
```

